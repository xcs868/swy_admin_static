
# nginx 环境变量

ENV TZ=Asia/Shanghai
//监听端口
ENV NGINX_LISTEN="80"
//工作进程数 10M
ENV NGINX_WORKER_PROCESSES="2"
//监听地址
ENV NGINX_FASTCGI_PASS_HOST="127.0.0.1"
//监听端口
ENV NGINX_FASTCGI_PASS_PORT="9000"
//工作目录
ENV NGINX_ROOT="/var/www/html"
//错误日志格式
ENV NGINX_ERROR_LOG="/var/log/nginx/error.log  warn"
//连接数
ENV NGINX_WORKER_CONNECTIONS="51200"
ENV NGINX_SERVER_NAMES_HASH_BUCKET_SIZE="128"
ENV NGINX_CLIENT_HEADER_BUFFER_SIZE="10m"
ENV NGINX_LARGE_CLIENT_HEADER_BUFFERS="4 10m"
ENV NGINX_CLIENT_MAX_BODY_SIZE="1024m"
ENV NGINX_CLIENT_BODY_BUFFER_SIZE="10m"
ENV NGINX_KEEPALIVE_TIMEOUT="120"
ENV NGINX_ACCESS_LOG="/var/log/nginx/access.log main"

# php 环境变量

ENV TZ=Asia/Shanghai
//环境
ENV APP_ENV=product
ENV PHP_DATE_TIMEZONE="Asia/Shanghai"
//错误输出地址
ENV PHP_ERROR_LOG="/proc/self/fd/2"
ENV PHP_LOG_LEVEL="notice"
ENV PHP_PROCESS_MAX=0
ENV PHP_RLIMIT_FILES=51200
ENV PHP_RLIMIT_CORE=0
ENV PHP_USER=www-data
ENV PHP_GROUP=www-data
//监听地址
ENV PHP_LISTEN=0.0.0.0:9000
//进程管理配置,一个进程大概 60M
ENV PHP_PM=dynamic
ENV PHP_PM_MAX_CHILDREN=10
ENV PHP_PM_START_SERVERS=4
ENV PHP_PM_MIN_SPARE_SERVERS=2
ENV PHP_PM_MAX_SPARE_SERVERS=8
ENV PHP_PM_PROCESS_IDLE_TIMEOUT=10s
ENV PHP_PM_MAX_REQUESTS=500
ENV PHP_SLOWLOG="/proc/self/fd/2"
ENV PHP_REQUEST_SLOWLOG_TIMEOUT="2s"
ENV PHP_REQUEST_TERMINATE_TIMEOUT="120s"
ENV PHP_MAX_EXECUTION_TIME=600
ENV PHP_MAX_INPUT_TIME=60
//内存限制
ENV PHP_MEMORY_LIMIT=384M
ENV PHP_ERROR_REPORTING="E_ALL"
ENV PHP_DISPLAY_ERRORS="On"
ENV PHP_DISPLAY_STARTUP_ERRORS="On"
ENV PHP_POST_MAX_SIZE=50M
ENV PHP_UPLOAD_MAX_FILESIZE=50M
ENV PHP_MAX_FILE_UPLOADS=20
ENV PHP_ACCESS_LOG="/proc/self/fd/2"
ENV PHP_TRACK_ERRORS=On
ENV PHP_ACCESS_FORMAT="{ \"type\": \"access\", \"time\": \"%t\", \"environment\": \"%{APP_ENV}e\", \"method\": \"%m\", \"request_uri\": \"%r%Q%q\", \"status_code\": \"%s\", \"cost_time\": \"%{mili}d\", \"cpu_usage\": { \"user\" : \"%{user}C\", \"system\": \"%{system}C\", \"total\": \"%{total}C\" }, \"memory_usage\": \"%{bytes}M\", \"remote_ip\": \"%R\", \"module\": \"php-fpm\", \"log_type\": \"access-log\" }"


ENV PHP_YAF_USE_NAMESPACE=Off
ENV PHP_YAF_USE_SPL_AUTOLOAD=On
ENV PHP_YAR_CONNECT_TIMEOUT=1000
ENV PHP_YAR_TIMEOUT=5000
ENV PHP_YAR_DEBUG=off

ENV PHP_OPCACHE_ENABLE=0
ENV PHP_OPCACHE_ENABLE_CLI=1
ENV PHP_OPCACHE_MEMORY_CONSUMPTION=384
ENV PHP_OPCACHE_INTERNED_STRINGS_BUFFER=8
ENV PHP_OPCACHE_MAX_ACCELERATED_FILES=100000
ENV PHP_OPCACHE_MAX_WASTED_PERCENTAGE=5
ENV PHP_OPCACHE_USE_CWD=1
ENV PHP_OPCACHE_VALIDATE_TIMESTAMPS=0
ENV PHP_OPCACHE_REVALIDATE_FREQ=60
ENV PHP_OPCACHE_FAST_SHUTDOWN=1
ENV PHP_OPCACHE_CONSISTENCY_CHECKS=0
